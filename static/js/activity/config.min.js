function import$(e,t){var n={}.hasOwnProperty;for(var i in t)n.call(t,i)&&(e[i]=t[i]);return e}ldc.register("period",[],function(){var e,t,n,i,r;return{idx:0},e={idx:0,cfg:{periods:[{name:"預設",config:{},start:"",end:""},{name:"提案期",config:{},start:"",end:""}]}},t=function(){return n.update(e)},n=new ctrlz({obj:JSON.parse(JSON.stringify(e))}),i={root:document.body,init:{},handler:{},action:{click:{},input:{}}},import$(i.action.input,{"period-name":function(n){var i,o,d;if(i=n.node,o=(i.value||"").trim(),d=!o||~e.cfg.periods.map(function(e){return e.name}).indexOf(o)&&e.cfg.periods[e.idx].name!==o,i.classList.toggle("is-invalid",d),!d)return e.cfg.periods[e.idx].name=i.value,t(),r.render()}}),import$(i.action.click,{periods:function(n){var i,o,d,a,c,s,u;if(n.node,i=n.evt,o=i.target,d=o.getAttribute("data-type")){if(a=e.cfg.periods.map(function(e){return e.name}),"new-period"===d){for(c=1;c<100&&(s=c,~a.indexOf("時段"+s));++c);u="時段"+(s<100?s:Math.round(100*Math.random())+100),e.cfg.periods.push({name:u,desc:"自訂時段",config:{}})}else u=o.getAttribute("data-name"),e.idx=a.indexOf(u);return t(),r.render()}},"delete-period":function(n){return n.node,n.evt,console.log(e.idx),e.cfg.periods.length<=1?alert("最少要有一個階段"):~e.idx?(e.cfg.periods.splice(e.idx,1),e.idx=0,t(),r.render()):void 0}}),import$(i.handler,{"default-view":function(t){return t.node.classList.toggle("d-none",0!==e.idx)},"custom-view":function(t){return t.node.classList.toggle("d-none",0===e.idx)},"period-name":function(t){var n,i,r;return n=t.node,n.value=e.cfg.periods[e.idx].name,i=(n.value||"").trim(),r=!i||~e.cfg.periods.map(function(e){return e.name}).indexOf(i)&&e.cfg.periods[e.idx].name!==i,n.classList.toggle("is-invalid",r)},period:{list:function(){return e.cfg.periods},handle:function(t){var n,i,r,o;return n=t.node,i=t.data,r=t.idx,o=ld$.find(n,"a",0),o.innerText=i.name,o.classList.toggle("active",r===e.idx),o.setAttribute("data-name",i.name),o.setAttribute("data-type","tab"),o}}}),import$(i.action.input,{time:function(n){var i;return i=n.node,e.cfg.periods[e.idx][i.getAttribute("data-name")]=i.value,t()}}),import$(i.init,{time:function(e){var t;return t=e.node,flatpickr(t,{enableTime:!0,dateFormat:"Y-m-d H:i"})}}),import$(i.handler,{time:function(t){var n;return n=t.node,n.value=e.cfg.periods[e.idx][n.getAttribute("data-name")]||""}}),import$(i.action.click,{switch:function(n){var i,r,o;if((i=n.node).classList.toggle("on"),r=(o=e.cfg.periods[e.idx]).config||(o.config={}))return r[i.getAttribute("data-name")]=i.classList.contains("on"),t()}}),import$(i.handler,{switch:function(t){var n,i;return(n=t.node).classList.toggle("on",!!((i=e.cfg.periods[e.idx]).config||(i.config={}))[n.getAttribute("data-name")])}}),r=new ldView(i),document.addEventListener("keydown",function(t){var i;if(90===t.keyCode&&(t.metaKey||t.ctrlKey))return t.shiftKey?n.redo():n.undo(),i=JSON.parse(JSON.stringify(n.get())),import$(e,i),r.render()})}),ldc.app("period");