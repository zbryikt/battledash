function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("perm",[],function(){var e,n,t,r;return e={idx:-1,name:"n/a",type:"all"},e.cfg={roles:[{name:"管理員",desc:"擁有管理此活動的所有權限，包含設定權限、更改任何設定等。",list:[{name:"Kirby Wu"},{name:"David Jones"},{name:"Beetle Juice"}]},{name:"評審",desc:"活動的提案評審，擁有個人的評審頁面，其評分表並會匯入評選大表中。",config:{},list:[{name:"clkao"},{name:"ipa chiu"}]}]},e.picked=e.cfg.roles[0],n=new ctrlz({obj:JSON.parse(JSON.stringify(e))}),t=debounce(function(){return n.update(e)}),r=new ldView({root:document.body,action:{input:{"role-name":function(n){var t,a;if(t=n.node,e.role)return a=t.value,~e.cfg.roles.map(function(e){return e.name}).indexOf(a)?t.classList.add("is-invalid"):(t.classList.remove("is-invalid"),e.role.name===e.name&&(e.name=t.value),e.role.name=t.value,r.render())}},click:{"new-role":function(){return e.cfg.roles.push({name:"未命名",desc:"自訂角色",list:[]}),r.render(),t()},"delete-role":function(){return e.cfg.roles.length<=1?alert("最少要有一個角色"):~e.idx?(e.cfg.roles.splice(e.idx,1),e.idx=0,e.name="",e.type="all",delete e.role,t(),r.render()):void 0},"toggle-newuser":function(e){return e.node,r.getAll("newuser").map(function(e){return e.classList.toggle("d-none")})},switch:function(n){var r,a,i;if(r=n.node,n.evt,r.classList.toggle("on"),a=(i=e.cfg.roles[e.idx]).cfg||(i.cfg={}))return a[r.getAttribute("data-name")]=r.classList.contains("on"),t()},roles:function(n){var a,i,o,l;if(a=n.node,i=n.evt,o=i.target.getAttribute("data-type"))return e.type=o,e.name=i.target.getAttribute("data-name")||"",e.idx=l=e.cfg.roles.map(function(e){return e.name}).indexOf(e.name),e.role=e.cfg.roles[l],ld$.find(a,".nav-link").map(function(e){return e.classList.remove("active")}),i.target.classList.add("active"),t(),r.render()},new:function(n){var a,i;return n.node,n.evt,a=("all"===e.type?e.picked:e.role)||e.cfg.roles[0]||{name:""},i=r.get("new-name").value,~e.cfg.roles.map(function(e){return e.list}).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return e.name}).indexOf(i)?alert("user already exist"):(a.list.push({name:i,perm:e.name}),t(),r.render())}}},handler:{newuser:function(){},list:function(){},all:function(){},"new-name":function(){},"new-type":function(){},role:{list:function(){return e.cfg.roles},handler:function(n){var t,r,a;return t=n.node,r=n.data,(a=ld$.find(t,".nav-link",0)).classList.toggle("active",r.name===e.name),a.setAttribute("data-name",r.name),a.setAttribute("data-type","custom"),a.innerText=r.name}},"picked-role":function(n){var t;return t=n.node,t.innerText=(e.picked||e.cfg.roles[0]||{name:""}).name},"role-name":function(n){var t;if((t=n.node).classList.toggle("d-none",!e.role),e.role)return t.value=e.role.name},"role-option":{list:function(){return e.cfg.roles},action:{click:function(n){var t;return n.node,t=n.data,e.picked=t,r.render("picked-role")}},handler:function(e){var n,t;return n=e.node,t=e.data,n.setAttribute("value",t.name),n.innerText=t.name}},"role-desc":{list:function(){return e.cfg.roles},action:{input:function(e){var n,r;return n=e.node,r=e.data,r.desc=n.innerText,t()}},handler:function(n){var t,r;return t=n.node,r=n.data,t.innerText=r.desc||"",t.setAttribute("data-name",r.name),t.classList.toggle("d-none",r.name!==e.name)}},"role-all":function(n){return n.node.classList.toggle("active","all"===e.type)},"role-desc-all":function(n){return n.node.classList.toggle("d-none","all"!==e.type)},"roles-desc":function(n){var t;return t=n.node,ld$.find(t,"[data-name]").map(function(n){return n.classList.toggle("d-none",e.name!==n.getAttribute("data-name"))})},"all-list":function(n){return n.node.classList.toggle("d-none","all"!==e.type)},"custom-list":function(n){return n.node.classList.toggle("d-none","custom"!==e.type)},switch:function(n){var t,r;if(t=n.node,e.role)return t.classList.toggle("on",!!((r=e.role).cfg||(r.cfg={}))[t.getAttribute("data-name")])},user:{list:function(){return e.role?(e.role.list||[]).map(function(n){return n.perm=e.role.name,n}):e.cfg.roles.map(function(e){return e.list.map(function(n){return n.perm=e.name,n})}).reduce(function(e,n){return e.concat(n)},[])},handler:function(e){var n,t,r;if(n=e.node,t=e.data,ld$.find(n,"b",0).innerText=t.name,r=ld$.find(n,".text-muted",0))return r.innerText=t.perm},action:{click:function(n){var a,i,o;if(n.node,a=n.data,n.evt.target.classList.contains("i-close")&&~(i=e.cfg.roles.map(function(e){return e.name}).indexOf(a.perm))&&~(o=e.cfg.roles[i].list).indexOf(a))return o.splice(o.indexOf(a),1),r.render("user"),t()}}},nav:function(){}}},document.addEventListener("keydown",function(t){if(90===t.keyCode&&(t.metaKey||t.ctrlKey))return n.undo(),import$(e,JSON.parse(JSON.stringify(n.get()))),e.role=e.cfg.roles[e.idx],r.render()}))}),ldc.app("perm");