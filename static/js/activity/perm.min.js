function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("perm",[],function(){var e,n,t,r,a,o,i,l,c;return e={type:"all"},n={idx:-1,cfg:{roles:[{name:"管理員",desc:"擁有管理此活動的所有權限，包含設定權限、更改任何設定等。",list:[{name:"Kirby Wu"},{name:"David Jones"},{name:"Beetle Juice"}]},{name:"評審",desc:"活動的提案評審，擁有個人的評審頁面，其評分表並會匯入評選大表中。",list:[{name:"clkao"},{name:"ipa chiu"}]}]}},t=function(){var t,r,a,o;return t=n.cfg.roles[r=n.idx],a=t?t.name:"",o=~r?"role":"all",e.idx=r,e.role=t,e.name=a,e.type=o,e},r=function(){return t(),c.render()},a=function(e){return e?o():i.update(n)},o=debounce(function(){return i.update(n)}),i=new ctrlz({obj:JSON.parse(JSON.stringify(n))}),l={root:document.body,action:{click:{},keyup:{}},handler:{}},import$(l.action.click,{roles:function(e){var t;return e.node,t=e.evt,n.idx=n.cfg.roles.map(function(e){return e.name}).indexOf(t.target.getAttribute("data-name")),a(),r()},"new-role":function(e){var t,o,i,l,c;for(e.node,t=e.evt,o=n.cfg.roles.map(function(e){return e.name}),i=1;i<100&&(l=i,~o.indexOf("角色"+l));++i);return c="角色"+(l<100?l:Math.round(100*Math.random())+100),n.cfg.roles.push({name:c,desc:"自訂角色",list:[]}),n.idx=n.cfg.roles.length-1,a(),r(),t.stopPropagation()},"delete-role":function(){return n.cfg.roles.length<=1?alert("最少要有一個角色"):~n.idx?(n.cfg.roles.splice(n.idx,1),n.idx=-1,a(),r()):void 0}}),import$(l.action.keyup,{"role-name":function(t){var o,i,l;if(o=t.node,e.role){if(i=o.value,l=~n.cfg.roles.map(function(e){return e.name}).indexOf(i)&&e.name!==i,o.classList.toggle("is-invalid",l),l)return;return e.role.name=o.value,a(),r()}}}),import$(l.handler,{"role-view":function(n){return n.node.classList.toggle("d-none","role"!==e.type)},role:{list:function(){return n.cfg.roles},handler:function(n){var t,r,a;return t=n.node,r=n.data,(a=ld$.find(t,".nav-link",0)).classList.toggle("active",r.name===e.name),a.setAttribute("data-name",r.name),a.setAttribute("data-type","role"),a.innerText=r.name}},"role-name":function(t){var r,a;return(r=t.node).classList.toggle("d-none",!~n.idx),e.role&&(r.value=e.name),a=r.value,r.classList.toggle("is-invalid",~n.cfg.roles.map(function(e){return e.name}).indexOf(a)&&e.name!==a)},"role-desc":{list:function(){return n.cfg.roles},action:{keyup:function(e){var n,t;return n=e.node,t=e.data,t.desc=n.innerText,a(!0)}},handler:function(n){var t,r;return t=n.node,r=n.data,t.innerText=r.desc||"",t.setAttribute("data-name",r.name),t.classList.toggle("d-none",r.name!==e.name)}},"role-all":function(n){return n.node.classList.toggle("active","all"===e.type)},"role-desc-all":function(n){return n.node.classList.toggle("d-none","all"!==e.type)}}),c=new ldView(l),document.addEventListener("keydown",function(e){var t;if(90===e.keyCode&&(e.metaKey||e.ctrlKey))return e.shiftKey?i.redo():i.undo(),t=JSON.parse(JSON.stringify(i.get())),n.idx=t.idx,n.cfg=t.cfg,r()})}),ldc.app("perm");