function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("perm2",[],function(){var e,n,t,r,a,o;return e={},n={idx:-1,name:"n/a",type:"all"},n.cfg={roles:[{name:"管理員",desc:"擁有管理此活動的所有權限，包含設定權限、更改任何設定等。",list:[{name:"Kirby Wu"},{name:"David Jones"},{name:"Beetle Juice"}]},{name:"評審",desc:"活動的提案評審，擁有個人的評審頁面，其評分表並會匯入評選大表中。",config:{},list:[{name:"clkao"},{name:"ipa chiu"}]}]},n.picked=n.cfg.roles[0],t=new ctrlz({obj:JSON.parse(JSON.stringify(n))}),r=function(e){var n;if(r.ret=n=a(),!e)return n.now(),r.ret=null},a=debounce(function(){return console.log("update"),t.update(n)}),o=new ldView({root:document.body,action:{keyup:{"role-name":function(t){var a,i;if(a=t.node,e.role)return i=a.value,~n.cfg.roles.map(function(e){return e.name}).indexOf(i)&&e.role&&e.role.name!==i?a.classList.add("is-invalid"):(a.classList.remove("is-invalid"),e.role.name===n.name&&(n.name=a.value),e.role.name=a.value,console.log("here"),r(!0),o.render())}},click:{"new-role":function(){var e,t,a,i;for(e=n.cfg.roles.map(function(e){return e.name}),t=1;t<100&&(a=t,~e.indexOf("角色"+a));++t);return i="角色"+(a<100?a:Math.round(100*Math.random())+100),n.cfg.roles.push({name:i,desc:"自訂角色",list:[]}),o.render(),r()},"delete-role":function(){return n.cfg.roles.length<=1?alert("最少要有一個角色"):~n.idx?(n.cfg.roles.splice(n.idx,1),n.idx=0,n.name="",n.type="all",delete e.role,r(),o.render()):void 0},"toggle-newuser":function(e){return e.node,o.getAll("newuser").map(function(e){return e.classList.toggle("d-none")})},switch:function(e){var t,a,o;if(t=e.node,e.evt,t.classList.toggle("on"),a=(o=n.cfg.roles[n.idx]).cfg||(o.cfg={}))return a[t.getAttribute("data-name")]=t.classList.contains("on"),r()},roles:function(t){var a,i,l,c;if(a=t.node,i=t.evt,l=i.target.getAttribute("data-type"))return n.type=l,n.name=i.target.getAttribute("data-name")||"",n.idx=c=n.cfg.roles.map(function(e){return e.name}).indexOf(n.name),e.role=n.cfg.roles[c],ld$.find(a,".nav-link").map(function(e){return e.classList.remove("active")}),i.target.classList.add("active"),r(),o.render()},new:function(t){var a,i;return t.node,t.evt,a=("all"===n.type?n.picked:e.role)||n.cfg.roles[0]||{name:""},i=o.get("new-name").value,~n.cfg.roles.map(function(e){return e.list}).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return e.name}).indexOf(i)?alert("user already exist"):(a.list.push({name:i,perm:n.name}),r(),o.render())}}},handler:{newuser:function(){},list:function(){},all:function(){},"new-name":function(){},"new-type":function(){},role:{list:function(){return n.cfg.roles},handler:function(e){var t,r,a;return t=e.node,r=e.data,(a=ld$.find(t,".nav-link",0)).classList.toggle("active",r.name===n.name),a.setAttribute("data-name",r.name),a.setAttribute("data-type","custom"),a.innerText=r.name}},"picked-role":function(e){var t;return t=e.node,t.innerText=(n.picked||n.cfg.roles[0]||{name:""}).name},"role-name":function(t){var r,a;return(r=t.node).classList.toggle("d-none",!e.role),e.role&&(r.value=e.role.name),a=r.value,~n.cfg.roles.map(function(e){return e.name}).indexOf(a)&&e.role&&e.role.name!==a?r.classList.add("is-invalid"):r.classList.remove("is-invalid")},"role-option":{list:function(){return n.cfg.roles},action:{click:function(e){var t;return e.node,t=e.data,n.picked=t,o.render("picked-role")}},handler:function(e){var n,t;return n=e.node,t=e.data,n.setAttribute("value",t.name),n.innerText=t.name}},"role-desc":{list:function(){return n.cfg.roles},action:{keyup:function(e){var n,t;return n=e.node,t=e.data,t.desc=n.innerText,r(!0)}},handler:function(e){var t,r;return t=e.node,r=e.data,t.innerText=r.desc||"",t.setAttribute("data-name",r.name),t.classList.toggle("d-none",r.name!==n.name)}},"role-all":function(e){return e.node.classList.toggle("active","all"===n.type)},"role-desc-all":function(e){return e.node.classList.toggle("d-none","all"!==n.type)},"roles-desc":function(e){var t;return t=e.node,ld$.find(t,"[data-name]").map(function(e){return e.classList.toggle("d-none",n.name!==e.getAttribute("data-name"))})},"all-list":function(e){return e.node.classList.toggle("d-none","all"!==n.type)},"custom-list":function(e){return e.node.classList.toggle("d-none","custom"!==n.type)},switch:function(n){var t,r;if(t=n.node,e.role)return t.classList.toggle("on",!!((r=e.role).cfg||(r.cfg={}))[t.getAttribute("data-name")])},user:{list:function(){return e.role?(e.role.list||[]).map(function(n){return n.perm=e.role.name,n}):n.cfg.roles.map(function(e){return e.list.map(function(n){return n.perm=e.name,n})}).reduce(function(e,n){return e.concat(n)},[])},handler:function(e){var n,t,r;if(n=e.node,t=e.data,ld$.find(n,"b",0).innerText=t.name,r=ld$.find(n,".text-muted",0))return r.innerText=t.perm},action:{click:function(e){var t,a,i;if(e.node,t=e.data,e.evt.target.classList.contains("i-close")&&~(a=n.cfg.roles.map(function(e){return e.name}).indexOf(t.perm))&&~(i=n.cfg.roles[a].list).indexOf(t))return i.splice(i.indexOf(t),1),o.render("user"),r()}}},nav:function(){}}},document.addEventListener("keydown",function(a){var i;if(90===a.keyCode&&(a.metaKey||a.ctrlKey))return(r.ret?(i=r.ret,r.ret.now(),r.ret=null,i.then(function(){return t.update(n)})):Promise.resolve()).then(function(){return console.log(1),t.undo(),import$(n,JSON.parse(JSON.stringify(t.get()))),e.role=n.cfg.roles[n.idx],o.render()})}))}),ldc.app("perm");