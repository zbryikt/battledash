extends /base.pug
block vars
  - ctrl.navtop.shown = true
  - ctrl.navtop.placeholder = false
  - ctrl.navtop.className = "navbar-light bg-semi-light"
  - ctrl.foot.shown = false
  - isall = false
  -
    var prjs = [
      ["開放 SaaS 平台"],
      ["線上資料庫"],
      ["選舉指南"],
      ["點對點分散式網路"],
      ["剩食大平台"],
      ["求職小幫手"],
      ["美國台灣觀測協會"],
      ["國會監視器"],
      ["協作資料夾 2.0"],
      ["線上課程平台"],
      ["協作式筆記系統"],
      ["剩食資料庫系統"],
      ["社區食倉"],
      ["文字工作者大平台"],
      ["自動逐字稿輔助編寫平台"],
      ["司法透視鏡 - 一起監督司法"],
      ["台灣ㄟ姻仔"],
      ["農業微型監視儀"],
      ["台灣在地化分散式字點"],
      ["xota.co"],
      ["從 AM2.5 到 PM2.5"],
      ["新聞儀表板"],
      ["山林間測快手"],
      ["台灣在地化地圖計畫"],
      ["資訊透明度量表"],
      ["智慧漸凍人補助器"],
      ["離職書產生器"]
    ]

block head
  +css("https://cdn.jsdelivr.net/npm/handsontable@6.2.2/dist/handsontable.min.css")
  style(type="text/css"): :stylus
    .table .toggle:hover
      background: #eeeff0
      cursor: pointer
    tr.check
      background: #fafbfc
      color: #444
    tr.active
      background: #ff9!important
      box-shadow: inset 0 0 10px 2px rgba(255,255,255,1)
    .handsontable
      font-size: 14px
      td, th
        vertical-align: middle
        text-align: center
    .handsontable td.auto
      background: #f9fafb
      color: #47b
block body
  include /design/mixins/index.pug
  .h-100.w-100

    #review-comment.ldcv: .base.w-480: .inner.card.shadow-sm
      .card-header.shadow-sm.position-relative.z-float
        p.mb-0 資格審核附註
        h4.mb-0 點對點分散式網路
      textarea.form-control.border-0.rounded-0(rows="5",placeholder="在這裡輸入您的附註 ... ")
      .card-footer
        .d-flex.justify-content-between
          .btn.btn-primary(data-ldcv-set="") 關閉

    #review-detail.ldcv: .base.w-480: .inner.card.shadow-sm
      .card-header.shadow-sm.position-relative.z-float
        p.mb-0 資格審核附註
        h4.mb-0 點對點分散式網路
      .card-body
        .d-flex
          .mr-4.pr-4
            .mb-2: b 通過 #[i.i-check.text-success]
            each i in [1,2,3]
              +user.mr-2
          .mr-4.pr-4
            .mb-2: b 待驗證 #[i.i-circle]
            each i in [1]
              +user.mr-2
          div
            .mb-2: b 不符 #[i.i-close.text-danger]
            each i in [1,2]
              +user.mr-2
        hr
        each i in [1,2,3]
          div: b Kirby Wu:
          .border-left.pl-2.mb-4 開發一個網頁工具，使用者可以輸入關鍵字，快速瀏覽開放過的相關資料和政府辦理民眾資料申請的情形。
      .card-footer
        .d-flex.justify-content-between
          .btn.btn-outline-secondary 捨棄
          .btn.btn-primary(data-ldcv-set="") 完成

    .d-flex.flex-column.h-100.w-100
      div(style="height:56px")
      .d-flex.flex-grow-1.w-100.h-100
        .py-2.h-100(style="flex:3 0 auto"): .position-relative.h-100.w-100
          #example.w-100.h-100.position-absolute.border-bottom.border-top(style="overflow:scroll")
            .sticky(style="top:0")
              .p-2.bg-white.d-flex.text-muted.text-sm.justify-content-end
                .flex-grow-1.d-flex
                  .mx-3 總計 #[span.text-danger 50]
                  .mx-3 通過 #[span.text-danger 42]
                  .mx-3 待審 #[span.text-danger 4]
                  .mx-3 退件 #[span.text-danger 4]
                .mx-3 #[i.i-circle] / 待驗證
                .mx-3 #[i.i-check.text-success] / 通過
                .mx-3 #[i.i-close.text-danger] / 不符合
                .mx-3 #[i.i-doc.text-danger] / 帶附註
              table.table.w-100.bg-light.border-bottom.mb-0.shadow-sm
                tr
                  td.text-center(style="width:2em"): i.i-circle
                  td.text-center(style="width:2em"): i.i-doc
                  td.text-right(style="width:4em") 編號
                  td
                    .d-flex.align-items-end
                      .flex-grow-1 提案名稱
                      .text-sm.text-primary #[i.i-question] 審核條件
                  if isall
                    td.text-center(style="width:4em") 通過
                    td.text-center(style="width:4em") 待審
                    td.text-center(style="width:4em") 不符
                    td.text-center(style="width:4em") 細節
                  else
                    td.text-center(style="width:4em") 開源
                    td.text-center(style="width:4em") 協作
                    td.text-center(style="width:4em") 重用
                    td.text-center(style="width:4em") 評論

            table.table.w-100.mb-0
              tr
                td.text-center.p-0(style="width:2em")
                td.text-center.p-0(style="width:2em")
                td.text-right.p-0(style="width:4em")
                td.p-0
                if isall
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")
                else
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")
                  td.text-center.p-0(style="width:4em")

              each item,$index in prjs
                tr(class=($index == 1 ? "active" : (Math.random() > 0.2 ? "check" : (Math.random() > 0.5 ? "pend" : "fail"))))
                  td.text-center
                    if Math.random() > 0.2
                      i.i-check.text-success
                    else if Math.random() > 0.5
                      i.i-circle.text-secondary
                    else
                      i.i-close.text-danger
                  td.text-center
                    if Math.random() > 0.8
                      span.ml-1.text-danger: i.i-doc

                  td.text-right(style="width:4em") #{$index + 1}
                  td
                    span #{item[0]}
                  if isall
                    td.text-center= Math.round(Math.random() * 1) + 2
                    td.text-danger.text-center= Math.round(Math.random() * 2) + 1
                    td.text-danger.text-center= Math.round(Math.random() * 3) + 0
                    td.text-center.clickable(ld="detail") #[i.i-pen]

                  else

                    each i in [1,2,3]
                      td.text-center.toggle
                        if Math.random() > 0.2
                          i.i-check.text-success
                        else if Math.random() > 0.5
                          i.i-circle.text-secondary
                        else
                          i.i-close.text-danger
                    td.text-center.clickable(ld="comment") #[i.i-pen]

        .h-100(style="flex:1 0 auto")
          .card.border.shadow.w-100.h-100(style="overflow:hidden;border-radius: .5em 0 0 .5em"): .card-body.p-0
            iframe.border-0.w-100.h-100(src="https://battledash.dev/project/simple.html")
            //-object.w-100.h-100(data="/assets/sample/simple-pdf.pdf",type="application/pdf")
              embed(src="/assets/sample/simple-pdf.pdf",type="application/pdf")
   
block script
  script: :lsc
    ldcv-comment = new ldCover root: \#review-comment
    ldcv-detail = new ldCover root: \#review-detail
    view = new ldView do
      root: document.body
      action: click: do
        comment: ({node}) -> ldcv-comment.toggle!
        detail: ({node}) -> ldcv-detail.toggle!
  //-script: :lsc

    data = [
      ["編號","不推薦數","專案名稱","創意","技術","完整","總分","排名","短評"],
      [1,0,"開放 SaaS 平台",29,26,36,91,2,"很適合用支持其它開源專案"],
      [2,0,"線上資料庫",30,15,39,84,3,"不知道這個要怎麼實作"],
      [3,1,"選舉指南",19,13,20,52,22,''],
      [4,0,"點對點分散式網路",30,10,22,62,14,"感覺很不容易做得好"],
      [5,0,"剩食大平台",18,13,37,68,12,''],
      [6,0,"求職小幫手",29,28,25,82,4,''],
      [7,1,"美國台灣觀測協會",11,24,34,69,14],
      [8,1,"國會監視器",10,28,31,69,10,"如果可以自動化會更好"],
      [9,0,"協作資料夾 2.0",29,25,38,92,4],
      [10,0,"線上課程平台",27,12,33,72,16],
      [11,0,"協作式筆記系統",13,15,34,62,10],
      [12,0,"剩食資料庫系統",23,21,30,74,23],
      [13,2,"社區食倉",17,18,23,58,18,"感覺很多同性質的提案了"],
      [14,0,"文字工作者大平台",25,13,24,62,23],
      [15,0,"自動逐字稿輔助編寫平台",29,26,21,76,18],
      [16,0,"司法透視鏡 - 一起監督司法",12,14,15,41,8],
      [17,3,"台灣ㄟ姻仔",15,21,37,73,23],
      [18,3,"農業微型監視儀",21,18,18,57,18],
      [19,0,"台灣在地化分散式字點",15,13,32,60,15],
      [20,0,"xota.co",23,11,24,58,25],
      [21,0,"從 AM2.5 到 PM2.5",21,21,10,52,8],
      [22,1,"新聞儀表板",20,11,26,57,17],
      [23,0,"山林間測快手",26,14,39,79,18],
      [24,0,"台灣在地化地圖計畫",11,11,21,43,8],
      [25,2,"資訊透明度量表",19,12,13,44,27],
      [26,0,"智慧漸凍人補助器",20,15,16,51,25],
      [27,0,"離職書產生器",17,24,22,63,20]
    ]


    dom = ld$.find document, '#example', 0
    Handsontable.renderers.registerRenderer \myrenderer, (instance, td, row, col, prop, value, cellProperties) -> 
      Handsontable.renderers.TextRenderer.apply @, arguments
      if col >=6 and col <= 7 =>
        td.classList.add \auto
    hot = new Handsontable dom, {
      data: data
      rowHeaders: true
      colHeaders: true
      filters: true
      dropdownMenu: true
      stretchH: \all
      rowHeights: 25
      minRows: 50
      minCols: 15
      fixedRowsTop: 1,
      fixedColumnsLeft: 3,
      cells: (row, col) ->
        cellProperties = {}
        cellProperties.renderer = \myrenderer
        return cellProperties
      colWidths: [40,50,180,50,50,50,50,50,250]
      customBorders: [

        {
          range: { from : {row: 0, col: 2}, to: {row: 0, col: 2}},
          bottom: {width: 2, color: \#000}, right: {width: 2, color: \#000}
        }

        {
          range: { from : {row: 0, col: 5}, to: {row: 0, col: 5}},
          bottom: {width: 2, color: \#000}, right: {width: 1, color: \#444}
        }

        {
          range: { from : {row: 0, col: 7}, to: {row: 0, col: 7}},
          bottom: {width: 2, color: \#000}, right: {width: 1, color: \#444}
        }

        { range: { from : {row: 0, col: 0}, to: {row: 0, col: 50}}, bottom: {width: 2, color: \#000}}
        { range: { from : {row: 0, col: 2}, to: {row: 50, col: 2}}, right: {width: 2, color: \#000}}

        { range: { from : {row: 0, col: 5}, to: {row: 50, col: 5}}, right: {width: 1, color: \#444}}
        { range: { from : {row: 0, col: 7}, to: {row: 50, col: 7}}, right: {width: 1, color: \#444}}

      ]
    }

