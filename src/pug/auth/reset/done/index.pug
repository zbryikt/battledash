extends /auth/base.pug
block content
  h1 Password Reset.
  p Now #[a(href="#",onclick="lda.auth.show('login')") let's try] if you can login with your brand new password.
  img(src="/assets/img/p/auth/reset/key.svg")
  p 
    div Still not be able to login?
    div Try #[a(href="/auth/reset/") reseting it again] or #[a(href="#",onclick="lda.ldcvmgr.toggle('contact')") contact us] directly.
  .ldcv.ldcvmgr(data-name="logged-in",data-lock="true"): .base.w-640.rwd: .inner.card: .card-body.text-center: .p-4
    h1 You have logged in.
    p.mb-2 We will now redirect you to the homepage...
    br
    .ld.ldld.bare.running.em-1.m-auto

  script: :lsc
    ldc.register <[auth ldcvmgr]>, ({auth, ldcvmgr}) ->
      ensure = ->
        auth.ensure!
          .then -> window.location.href= \/
          .catch -> ensure!
      auth.get!then ->
        if it.{}user.key =>
          lda.ldcvmgr.toggle("logged-in")
          debounce 2000 .then -> window.location.href = \/
        else debounce 2000 .then -> lda.auth.is-on!then -> if !it => ensure!
